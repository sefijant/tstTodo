<?xml version="1.0" encoding="utf-8"?>
<configuration>
  <system.webServer>
 
    <httpErrors existingResponse="PassThrough" />
 
    <iisnode node_env="%node_env%"
                nodeProcessCountPerApplication="1"
                maxConcurrentRequestsPerProcess="1024"
                maxNamedPipeConnectionRetry="100"
                namedPipeConnectionRetryDelay="250"
                maxNamedPipeConnectionPoolSize="512"
                maxNamedPipePooledConnectionAge="30000"
                asyncCompletionThreadCount="0"
                initialRequestBufferSize="4096"
                maxRequestBufferSize="65536"
                uncFileChangesPollingInterval="5000"
                gracefulShutdownTimeout="60000"
                loggingEnabled="true"
                logDirectory="iisnode"
                debuggingEnabled="true"
                debugHeaderEnabled="false"
                debuggerPortRange="5058-6058"
                debuggerPathSegment="debug"
                maxLogFileSizeInKB="128"
                maxTotalLogFileSizeInKB="1024"
                maxLogFiles="20"
                devErrorsEnabled="true"
                flushResponse="false"
                enableXFF="false"
                promoteServerVars=""
                configOverrides="iisnode.yml"
                watchedFiles="web.config;*.js"
                nodeProcessCommandLine="D:\Program Files (x86)\nodejs\5.0.0\node.exe"/>
    <handlers>
      <add name="iisnode" path="server.js" verb="*" modules="iisnode"/>
    </handlers>
 
    <rewrite>
      <rules>
 
        <rule name="NodeInspector" patternSyntax="ECMAScript" stopProcessing="true">
            <match url="^server.js\/debug[\/]?"/>
        </rule>
 
        <rule name="StaticContent" patternSyntax="Wildcard">
            <action type="Rewrite" url="public/{R:0}" logRewrittenUrl="true"/>
            <conditions>
                <add input="{REQUEST_FILENAME}" matchType="IsFile" negate="true"/>
            </conditions>
            <match url="*.*"/>
        </rule>
 
        <rule name="DynamicContent">
          <conditions>
            <add input="{REQUEST_FILENAME}" matchType="IsFile" negate="True"/>
          </conditions>
          <action type="Rewrite" url="server.js"/>
        </rule>
      </rules>
    </rewrite>
    <directoryBrowse enabled="false"/>
  </system.webServer>
</configuration>